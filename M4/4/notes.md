# Занятие 28 — Проектирование БД + Нормализация + JOIN-ы + Views

## 1. Проектирование БД — два уровня
| Уровень         | Что делаем                                  | Главная цель                     |
|-----------------|---------------------------------------------|----------------------------------|
| Логическое      | Таблицы, атрибуты, ключи, связи             | Правильно отразить мир           |
| Физическое      | Индексы, партиции, денормализация и т.д.    | Быстро работает в конкретной СУБД |

## 2. Аномалии (почему «плохая» схема — зло)

| Тип аномалии              | Что происходит                                      | Пример из жизни                                 |
|---------------------------|-----------------------------------------------------|-------------------------------------------------|
| Добавления                | Нельзя добавить объект без «обязательного» другого | Рейс без пассажиров → нельзя добавить           |
| Изменения                 | Меняем в одном месте → надо менять в 1000 местах    | Меняем название рейса → правим у всех пассажиров|
| Удаления                  | Удаляем последнее → теряем важную информацию        | Последний пассажир сдал билет → пропал весь рейс|

## 3. Нормализация — убираем аномалии

| НФ  | Условие (просто запомни)                                      | Что убираем                              |
|-----|---------------------------------------------------------------|------------------------------------------|
| 1НФ | Нет повторяющихся групп, каждое поле — атомарное значение     | Повторяющиеся курсы в одной строке       |
| 2НФ | 1НФ + неключевые поля зависят от ВСЕГО составного ключа       | Описание курса зависит только от КодКурса|
| 3НФ | 2НФ + нет транзитивных зависимостей (неключ → неключ)         | Менеджер → КодМенеджера в таблице студентов|

**Золотое правило:** Доводи до 3НФ → потом (и только потом!) денормализуй.

## 4. Денормализация — осознанное нарушение 3НФ ради скорости

| Приём                     | Что делаем                                  | Когда реально нужно                     |
|---------------------------|---------------------------------------------|-----------------------------------------|
| Дублирование              | Копируем поля (customer_name в Orders)     | Частые SELECT без JOIN                  |
| Свёртывание               | Храним total, count вместо SUM/COUNT        | Дорогие отчёты                          |
| Горизонтальное разбиение  | Sales_2023, Sales_2024…                     | Таблица > 50–100 млн строк              |
| Вертикальное разбиение    | UsersHot (10 полей) + UsersCold (остальные) | SELECT читает только «горячие» столбцы  |

## 5. JOIN-ы — как правильно соединять таблицы

| Вид               | Что возвращает                                          | Синтаксис (хороший тон)                     |
|-------------------|---------------------------------------------------------|---------------------------------------------|
| INNER JOIN        | Только совпадающие строки                               | `FROM A INNER JOIN B ON A.id = B.a_id`      |
| LEFT JOIN         | Все строки из левой + NULL, где нет совпадений          | `FROM A LEFT JOIN B ON …`                   |
| RIGHT JOIN        | Все строки из правой                                    | (редко, можно перевернуть LEFT)            |
| CROSS JOIN        | Декартово произведение (каждая × каждая)                | `FROM suits CROSS JOIN ranks` → 52 карты    |

**Псевдонимы — обязательно!**  
```sql
SELECT p.id, p.product, b.brand
FROM products   AS p
JOIN brands     AS b ON p.brand_id = b.id;